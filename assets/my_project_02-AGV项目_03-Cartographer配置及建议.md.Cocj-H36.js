import{_ as t}from"./chunks/ArticleMetadata.v6H_tZE7.js";import{_ as e,C as r,c as d,o as l,k as p,G as g,P as A,a as C,w as y,b as c,e as o}from"./chunks/framework.CLT-Xekf.js";import"./chunks/md5.CFXlnVHb.js";const q=JSON.parse('{"title":"Cartographer配置及建议","description":"","frontmatter":{"title":"Cartographer配置及建议","author":"阿源","date":"2023/11/15 12:00","categories":["个人项目"],"tags":["个人项目","ROS"]},"headers":[],"relativePath":"my_project/02-AGV项目/03-Cartographer配置及建议.md","filePath":"my_project/02-AGV项目/03-Cartographer配置及建议.md","lastUpdated":1713341239000}'),D={name:"my_project/02-AGV项目/03-Cartographer配置及建议.md"};function F(i,s,_,B,E,u){const h=t,k=r("ClientOnly");return l(),d("div",null,[s[0]||(s[0]=p("h1",{id:"cartographer配置及建议",tabindex:"-1"},[C("cartographer配置及建议 "),p("a",{class:"header-anchor",href:"#cartographer配置及建议","aria-label":'Permalink to "cartographer配置及建议"'},"​")],-1)),g(k,null,{default:y(()=>{var a,n;return[(((a=i.$frontmatter)==null?void 0:a.aside)??!0)&&(((n=i.$frontmatter)==null?void 0:n.showArticleMetadata)??!0)?(l(),c(h,{key:0,article:i.$frontmatter},null,8,["article"])):o("",!0)]}),_:1}),s[1]||(s[1]=A(`<p>cartographer是google开发的实时室内SLAM项目,它采用基于ceres非线性优化的方法,其亮点在于代码规范与工程化,非常适合于商业应用和再开发。并且cartographer基于submap子图构建全局地图的思想,能有效的避免建图过程中环境中移动物体的干扰。此外,cartographer支持多传感器数据(odometry、IMU、LaserScan等)建图,也支持2D_SLAM和3D_SLAM建图。该算法能天然的输出协方差矩阵,后端优化的输入项,即便是使用成本较低的雷达也能跑出不错的效果。</p><h2 id="_1-工程化建议" tabindex="-1">1. 工程化建议 <a class="header-anchor" href="#_1-工程化建议" aria-label="Permalink to &quot;1. 工程化建议&quot;">​</a></h2><h3 id="_1-1-优点" tabindex="-1">1.1 优点 <a class="header-anchor" href="#_1-1-优点" aria-label="Permalink to &quot;1.1 优点&quot;">​</a></h3><p>代码架构十分优美 各个模块独立性很强, 可以很方便的进行修改, 或则是单独拿出来做其他应用 代码鲁棒性非常高, 很少出现莫名崩掉的情况, 错误提示很好 代码命名非常规范, 能够清楚的根据变量名与函数名判断其代表的含义 总之, cartographer 的代码十分值得学习与借鉴</p><h3 id="_1-2-缺点" tabindex="-1">1.2 缺点 <a class="header-anchor" href="#_1-2-缺点" aria-label="Permalink to &quot;1.2 缺点&quot;">​</a></h3><h4 id="点云的预处理" tabindex="-1">点云的预处理 <a class="header-anchor" href="#点云的预处理" aria-label="Permalink to &quot;点云的预处理&quot;">​</a></h4><p>发生的拷贝次数太多 自适应体素滤波如果参数不好时计算量太大</p><h4 id="位姿推测器" tabindex="-1">位姿推测器 <a class="header-anchor" href="#位姿推测器" aria-label="Permalink to &quot;位姿推测器&quot;">​</a></h4><ul><li>计算 pose 的线速度与角速度时, 是采用的数据队列开始和末尾的 2 个数据计算的</li><li>计算里程计的线速度与角速度时, 是采用的数据队列开始和末尾的 2 个数据计算的</li><li>使用里程计, 不使用 imu 时, 计算里程计的线速度方向和姿态的预测时, 用的是里程计数据队列开始和末尾的 2 个数据的平均角速度计算的, 时间长了就不准</li><li>不使用里程计, 不使用 imu 时, 用的是 pose 数据队列开始和末尾的 2 个数据的平均角速度计算的, 时间长了就不准</li><li>添加位姿时, 没有用 pose 的姿态对 imu_tracker_进行校准, 也没有对整体位姿预测器进行校准, 只计算了 pose 的线速度与角速度</li><li>从代码上看, cartographer 认为位姿推测器推测出来的位姿与姿态是准确的</li></ul><h4 id="改进建议" tabindex="-1">改进建议 <a class="header-anchor" href="#改进建议" aria-label="Permalink to &quot;改进建议&quot;">​</a></h4><ul><li>pose 的距离越小, 匀速模型越能代替机器人的线速度与角速度, 计算 pose 的线速度与角速度时, 可以考虑使用最近的 2 个数据进行计算</li><li>里程计距离越短数据越准, 计算里程计的线速度与角速度时, 可以考虑使用最近的2 个数据进行计算</li><li>使用里程计, 不使用 imu 时, 计算里程计的线速度方向时, 可以考虑使用里程计的角度进行计算</li><li>使用里程计, 不使用 imu 时, 进行姿态的预测时, 可以考虑使用里程计的角度进行预测</li><li>不使用里程计, 不使用 imu 时, 可以考虑用最近的 2 个 pose 计算线速度与角速度</li><li>使用 pose 对 imu_tracker_的航向角进行校准</li></ul><h4 id="基于-ceres-的扫描匹配" tabindex="-1">基于 Ceres 的扫描匹配 <a class="header-anchor" href="#基于-ceres-的扫描匹配" aria-label="Permalink to &quot;基于 Ceres 的扫描匹配&quot;">​</a></h4><p>平移和旋转的残差项是逼近于先验位姿的, 当先验位姿不准确时会产生问题</p><p>可能的改进建议 先将地图的权重调大, 平移旋转的权重调小, 如 1000, 1, 1, 或者 100, 1, 1</p><p>调参没有作用的时候可以将平移和旋转的残差项注释掉</p><h4 id="后端优化" tabindex="-1">后端优化 <a class="header-anchor" href="#后端优化" aria-label="Permalink to &quot;后端优化&quot;">​</a></h4><p>优化时的计算量太大, 可以根据自己需求调整参数, 或者增加计算前的过滤. 在计算子图间约束的时候, 目前 cartographer 是根据节点个数来做的, 定位时又根据时间来决定是否进行全子图的匹配, 这部分计算的判断可以根据自己的需求增加一些, 以减少计算量.</p><h3 id="_1-3-工程化的目的" tabindex="-1">1.3 工程化的目的 <a class="header-anchor" href="#_1-3-工程化的目的" aria-label="Permalink to &quot;1.3 工程化的目的&quot;">​</a></h3><p>根据机器人的传感器硬件, 最终能够实现稳定地构建一张不叠图的二维栅格地图. 由于 cartographer 代码十分的优秀, 所以 cartographer 的稳定性目前已经很好了, 比目前的大部分 slam 的代码都稳定, 很少会出现崩掉的情况, 最多就是会由于某些原因提示错误.</p><h3 id="_1-4-如何提升建图质量" tabindex="-1">1.4 如何提升建图质量 <a class="header-anchor" href="#_1-4-如何提升建图质量" aria-label="Permalink to &quot;1.4 如何提升建图质量&quot;">​</a></h3><p>最简单的一种方式, 选择好的传感器. 选择频率高(25hz 以上), 精度高的雷达, 精度高的imu, 这样的传感器配置下很难有建不好的地图.</p><h4 id="如果只能用频率低的雷达呢" tabindex="-1">如果只能用频率低的雷达呢？ <a class="header-anchor" href="#如果只能用频率低的雷达呢" aria-label="Permalink to &quot;如果只能用频率低的雷达呢？&quot;">​</a></h4><p>由于频率低时的叠图基本都是在旋转时产生的, 所以推荐使用一个好的 imu, 然后建图的时候让机器人的移动与旋转速度慢一点(建图轨迹与建图速度十分影响建图效果), 这时候再看建图效果. 如果效果还不行, 调 ceres 的匹配权重, 将地图权重调大, 平移旋转权重调小. 如果效果还不行, 可以将代码中平移和旋转的残差注释掉. 如果效果还不行, 那就得改代码了, 去改位姿推测器那部分的代码, 让预测的准一点</p><h4 id="里程计" tabindex="-1">里程计 <a class="header-anchor" href="#里程计" aria-label="Permalink to &quot;里程计&quot;">​</a></h4><p>为什么一直没有说里程计, 就是由于 cartographer 中对里程计的使用不太好. cartographer 中对里程计的使用有 2 部分, 一个是前端的位姿推测器, 一个是后端根据里程计数据计算残差. 后端部分的使用是没有问题的. 如果想要在 cartographer 中使用里程计达到比较好的效果, 前端的位姿推测器这部分需要自己重写. 可以将 karto 与 gmapping 的使用里程计进行预测的部分拿过来进行使用, 改完了之后就能够达到比较好的位姿预测效果了.</p><h4 id="粗匹配" tabindex="-1">粗匹配 <a class="header-anchor" href="#粗匹配" aria-label="Permalink to &quot;粗匹配&quot;">​</a></h4><p>cartographer 的扫描匹配中的粗匹配是一种暴力匹配的方法, 目的是对位姿预测出的位姿进行校准, 但是这个扫描匹配的计算量太大了, 导致不太好用. 这块可以进行改进, 可以将 karto 的扫描匹配的粗匹配放过来, karto 的扫描匹配的计算量很小, 当做粗匹配很不错.</p><h4 id="地图" tabindex="-1">地图 <a class="header-anchor" href="#地图" aria-label="Permalink to &quot;地图&quot;">​</a></h4><p>有时前端部分生成的地图出现了叠图, 而前端建的地图在后端是不会被修改的, 后端优化只会优化节点位姿与子图位姿. 同时 cartographer_ros 最终生成的地图是将所有地图叠加起来的, 就会导致这个叠图始终都存在, 又或者是后边的地图的空白部分将前边的地图的边给覆盖住了, 导致墙的黑边消失了. 后端优化会将节点与子图的位姿进行优化, 但是不会改动地图，所以可以在最终生成地图的时候使用后端优化后的节点重新生成一次地图, 这样生成的地图的效果会比前端地 图的叠加要好很多. 这块的实现可以参考一下实时生成三维点云地图部分的代码.</p><h4 id="更极致的修改" tabindex="-1">更极致的修改 <a class="header-anchor" href="#更极致的修改" aria-label="Permalink to &quot;更极致的修改&quot;">​</a></h4><p>后端优化后的节点与子图位姿是不会对前端产生影响的, 这块可以进行优化一下, 就是前端匹配的时候, 不再使用前端生成的地图进行匹配, 而是使用后端生成的地图进行匹配, 这样就可以将后端优化后的效果带给前端. 但是这要对代码进行大改, 比较费劲.</p><h3 id="_1-5-降低计算量与内存" tabindex="-1">1.5 降低计算量与内存 <a class="header-anchor" href="#_1-5-降低计算量与内存" aria-label="Permalink to &quot;1.5 降低计算量与内存&quot;">​</a></h3><ul><li>体素滤波与自适应体素滤波的计算量(不是很大)</li><li>后端进行子图间约束时的计算量很大</li><li>分支定界算法的计算量很大</li><li>降低内存, 内存的占用基本就是多分辨率地图这, 每个子图的多分辨率地图都进行保存是否有必要</li></ul><h3 id="_1-6-纯定位的建议" tabindex="-1">1.6 纯定位的建议 <a class="header-anchor" href="#_1-6-纯定位的建议" aria-label="Permalink to &quot;1.6 纯定位的建议&quot;">​</a></h3><p>目前 cartographer 的纯定位和正常的建图是一样的, 只是仅保存 3 个子图, 依然要进行后端优化. 这就导致了几个问题: 第一个: 前端的扫描匹配, 是当前的雷达点云与当前轨迹的地图进行匹配, 而不是和之前的地图进行匹配, 这就导致了定位时机器人当前的点云与之前的地图不一定能匹配很好,就是因为当前的点云是匹配当前轨迹的地图的, 不是与之前的地图进行匹配. 第二个: 纯定位其实就是建图, 所以依然会进行回环检测与后端优化, 而后端优化的计算在定位这是没有必要的, 带来了额外的计算量. 第三个: 纯定位依然会进行回环检测, 回环检测有可能导致机器人的位姿发生跳变.</p><h4 id="改进思路" tabindex="-1">改进思路 <a class="header-anchor" href="#改进思路" aria-label="Permalink to &quot;改进思路&quot;">​</a></h4><p>将纯定位模式与建图拆分开, 改成读取之前轨迹的地图进行匹配. 新的轨迹只进行位姿预测, 拿到预测后的位姿与之前轨迹的地图进行匹配, 新的轨迹不再进行地图的生成与保存. 同时将整个后端的功能去掉. 去掉了后端优化之后, 会导致没有重定位功能, 这时候可以将 cartographer 的回环检测(子图间约束的计算)部分单独拿出来, 做成一个重定位功能. 通过服务来调用这个重定位功能, 根据当前点云确定机器人在之前地图的位姿. 这样才是一个比较好的定位功能的思路.</p><h2 id="_2-cartographer运行" tabindex="-1">2. cartographer运行 <a class="header-anchor" href="#_2-cartographer运行" aria-label="Permalink to &quot;2. cartographer运行&quot;">​</a></h2><p>源码添加东西</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span>lx_rs16_2d_outdoor.lua</span></span>
<span class="line"><span>lx_rs16_2d_outdoor.launch</span></span>
<span class="line"><span>lx_2d.rviz</span></span>
<span class="line"><span></span></span>
<span class="line"><span>rslidar-outdoor-gps-notf.bag</span></span>
<span class="line"><span>一个户外的园区，大概30m*100m，使用速腾16线雷达，范围最远150m</span></span></code></pre></div><h3 id="地图保存" tabindex="-1">地图保存 <a class="header-anchor" href="#地图保存" aria-label="Permalink to &quot;地图保存&quot;">​</a></h3><p>通过map_server保存是没有地图边界的（不是黑色的），map_server占用的像素值一定要是100才表示占用，但是cartographer会小一点</p><p>自己写脚本：finish_slam_2d.sh</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">source</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> install_isolated/setup.bash</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">map_dir</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;\${</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">HOME</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">}/carto_ws/map&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">map_name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;2d-1&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 检查文件夹是否存在, 如果不存在就创建文件夹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [ </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">!</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> -d</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">$map_dir</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> ];</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">then</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">  echo</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;文件夹不存在, 正在创建文件夹&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  mkdir</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -p</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> $map_dir</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">fi</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># finish slam  结束轨迹</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">rosservice</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> call</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /finish_trajectory</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># make pbstream  生成pbstream文件</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">rosservice</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> call</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /write_state</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;{filename: &#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">$map_dir</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">$map_name</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.pbstream&#39;}&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># pbstream to map</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">rosrun</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> cartographer_ros</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> cartographer_pbstream_to_ros_map</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;"> \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">-pbstream_filename=$map_dir/$map_name.pbstream </span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;">\\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">-map_filestem=$map_dir/$map_name</span></span></code></pre></div><p>3d保存</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">source</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> install_isolated/setup.bash</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">map_dir</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;\${</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">HOME</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">}/carto_ws/map&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">map_name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;3d-1&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 检查文件夹是否存在, 如果不存在就创建文件夹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [ </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">!</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> -d</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">$map_dir</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> ];</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">then</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">  echo</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;文件夹不存在, 正在创建文件夹&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  mkdir</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -p</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> $map_dir</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">fi</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># finish slam</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">rosservice</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> call</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /finish_trajectory</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># make pbstream</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">rosservice</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> call</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /write_state</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;{filename: &#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">$map_dir</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">$map_name</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.pbstream&#39;}&quot;</span></span></code></pre></div><h3 id="rviz参数说明" tabindex="-1">rviz参数说明 <a class="header-anchor" href="#rviz参数说明" aria-label="Permalink to &quot;rviz参数说明&quot;">​</a></h3><p><img src="https://cdn.jsdelivr.net/gh/clint-sfy/blogcdn@master/ros/cartographer/20231116121244.png" alt=""></p><p>第一个是雷达的原始数据，第二个是处理过后的数据</p><p>Trajectories：小车的轨迹</p><p>constraints：约束可视化，两个节点间相对坐标变换</p><h2 id="_3-bag文件说明" tabindex="-1">3. bag文件说明 <a class="header-anchor" href="#_3-bag文件说明" aria-label="Permalink to &quot;3. bag文件说明&quot;">​</a></h2><h3 id="查看bag文件" tabindex="-1">查看bag文件 <a class="header-anchor" href="#查看bag文件" aria-label="Permalink to &quot;查看bag文件&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">rosbag</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> info</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span>path:        rslidar-outdoor-gps.bag</span></span>
<span class="line"><span>version:     2.0</span></span>
<span class="line"><span>duration:    3:33s (213s)</span></span>
<span class="line"><span>start:       Dec 01 2020 15:44:09.49 (1606808649.49)</span></span>
<span class="line"><span>end:         Dec 01 2020 15:47:43.48 (1606808863.48)</span></span>
<span class="line"><span>size:        2.1 GB</span></span>
<span class="line"><span>messages:    41623</span></span>
<span class="line"><span>compression: none [2064/2064 chunks]</span></span>
<span class="line"><span>types:       geometry_msgs/QuaternionStamped [e57f1e547e0e1fd13504588ffc8334e2]</span></span>
<span class="line"><span>             nav_msgs/Odometry               [cd5e73d190d741a2f92e81eda573aca7]</span></span>
<span class="line"><span>             sensor_msgs/Imu                 [6a62c6daae103f4ff57a132d6f95cec2]</span></span>
<span class="line"><span>             sensor_msgs/LaserScan           [90c7ef2dc6895d81024acba2ac42f369]</span></span>
<span class="line"><span>             sensor_msgs/NavSatFix           [2d3a8cd499b9b4a0249fb98fd05cfa48]</span></span>
<span class="line"><span>             sensor_msgs/PointCloud2         [1158d486dd51d683ce2f1be655c3c181]</span></span>
<span class="line"><span>             tf2_msgs/TFMessage              [94810edda583a504dfda3829e70d7eec]</span></span>
<span class="line"><span>topics:      /fix               1070 msgs    : sensor_msgs/NavSatFix          </span></span>
<span class="line"><span>             /front_scan        4127 msgs    : sensor_msgs/LaserScan          </span></span>
<span class="line"><span>             /heading            214 msgs    : geometry_msgs/QuaternionStamped</span></span>
<span class="line"><span>             /imu              21400 msgs    : sensor_msgs/Imu                </span></span>
<span class="line"><span>             /odom_scout        4279 msgs    : nav_msgs/Odometry              </span></span>
<span class="line"><span>             /rslidar_points    4126 msgs    : sensor_msgs/PointCloud2        </span></span>
<span class="line"><span>             /tf                6406 msgs    : tf2_msgs/TFMessage              (2 connections)</span></span>
<span class="line"><span>             /tf_static            1 msg     : tf2_msgs/TFMessage</span></span></code></pre></div><h3 id="imu数据格式" tabindex="-1">IMU数据格式 <a class="header-anchor" href="#imu数据格式" aria-label="Permalink to &quot;IMU数据格式&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span>std_msgs/Header header</span></span>
<span class="line"><span>  uint32 seq</span></span>
<span class="line"><span>  time stamp</span></span>
<span class="line"><span>  string frame_id</span></span>
<span class="line"><span>geometry_msgs/Quaternion orientation</span></span>
<span class="line"><span>  float64 x</span></span>
<span class="line"><span>  float64 y</span></span>
<span class="line"><span>  float64 z</span></span>
<span class="line"><span>  float64 w</span></span>
<span class="line"><span>float64[9] orientation_covariance</span></span>
<span class="line"><span>geometry_msgs/Vector3 angular_velocity</span></span>
<span class="line"><span>  float64 x</span></span>
<span class="line"><span>  float64 y</span></span>
<span class="line"><span>  float64 z</span></span>
<span class="line"><span>float64[9] angular_velocity_covariance</span></span>
<span class="line"><span>geometry_msgs/Vector3 linear_acceleration</span></span>
<span class="line"><span>  float64 x</span></span>
<span class="line"><span>  float64 y</span></span>
<span class="line"><span>  float64 z</span></span>
<span class="line"><span>float64[9] linear_acceleration_covariance</span></span></code></pre></div><h3 id="单线雷达" tabindex="-1">单线雷达 <a class="header-anchor" href="#单线雷达" aria-label="Permalink to &quot;单线雷达&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span>std_msgs/Header header</span></span>
<span class="line"><span>  uint32 seq</span></span>
<span class="line"><span>  time stamp</span></span>
<span class="line"><span>  string frame_id</span></span>
<span class="line"><span>float32 angle_min</span></span>
<span class="line"><span>float32 angle_max</span></span>
<span class="line"><span>float32 angle_increment</span></span>
<span class="line"><span>float32 time_increment</span></span>
<span class="line"><span>float32 scan_time</span></span>
<span class="line"><span>float32 range_min</span></span>
<span class="line"><span>float32 range_max</span></span>
<span class="line"><span>float32[] ranges</span></span>
<span class="line"><span>float32[] intensities</span></span></code></pre></div><h3 id="多线点云" tabindex="-1">多线点云 <a class="header-anchor" href="#多线点云" aria-label="Permalink to &quot;多线点云&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span>std_msgs/Header header</span></span>
<span class="line"><span>  uint32 seq</span></span>
<span class="line"><span>  time stamp</span></span>
<span class="line"><span>  string frame_id</span></span>
<span class="line"><span>uint32 height</span></span>
<span class="line"><span>uint32 width</span></span>
<span class="line"><span>sensor_msgs/PointField[] fields</span></span>
<span class="line"><span>  uint8 INT8=1</span></span>
<span class="line"><span>  uint8 UINT8=2</span></span>
<span class="line"><span>  uint8 INT16=3</span></span>
<span class="line"><span>  uint8 UINT16=4</span></span>
<span class="line"><span>  uint8 INT32=5</span></span>
<span class="line"><span>  uint8 UINT32=6</span></span>
<span class="line"><span>  uint8 FLOAT32=7</span></span>
<span class="line"><span>  uint8 FLOAT64=8</span></span>
<span class="line"><span>  string name</span></span>
<span class="line"><span>  uint32 offset</span></span>
<span class="line"><span>  uint8 datatype</span></span>
<span class="line"><span>  uint32 count</span></span>
<span class="line"><span>bool is_bigendian</span></span>
<span class="line"><span>uint32 point_step</span></span>
<span class="line"><span>uint32 row_step</span></span>
<span class="line"><span>uint8[] data</span></span>
<span class="line"><span>bool is_dense</span></span></code></pre></div><h3 id="里程计-1" tabindex="-1">里程计 <a class="header-anchor" href="#里程计-1" aria-label="Permalink to &quot;里程计&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span>std_msgs/Header header</span></span>
<span class="line"><span>  uint32 seq</span></span>
<span class="line"><span>  time stamp</span></span>
<span class="line"><span>  string frame_id</span></span>
<span class="line"><span>string child_frame_id</span></span>
<span class="line"><span>geometry_msgs/PoseWithCovariance pose</span></span>
<span class="line"><span>  geometry_msgs/Pose pose</span></span>
<span class="line"><span>    geometry_msgs/Point position</span></span>
<span class="line"><span>      float64 x</span></span>
<span class="line"><span>      float64 y</span></span>
<span class="line"><span>      float64 z</span></span>
<span class="line"><span>    geometry_msgs/Quaternion orientation</span></span>
<span class="line"><span>      float64 x</span></span>
<span class="line"><span>      float64 y</span></span>
<span class="line"><span>      float64 z</span></span>
<span class="line"><span>      float64 w</span></span>
<span class="line"><span>  float64[36] covariance</span></span>
<span class="line"><span>geometry_msgs/TwistWithCovariance twist</span></span>
<span class="line"><span>  geometry_msgs/Twist twist</span></span>
<span class="line"><span>    geometry_msgs/Vector3 linear</span></span>
<span class="line"><span>      float64 x</span></span>
<span class="line"><span>      float64 y</span></span>
<span class="line"><span>      float64 z</span></span>
<span class="line"><span>    geometry_msgs/Vector3 angular</span></span>
<span class="line"><span>      float64 x</span></span>
<span class="line"><span>      float64 y</span></span>
<span class="line"><span>      float64 z</span></span>
<span class="line"><span>  float64[36] covariance</span></span></code></pre></div><h2 id="_4-如何配置-launch-与-lua-文件" tabindex="-1">4. 如何配置 Launch 与 Lua 文件 <a class="header-anchor" href="#_4-如何配置-launch-与-lua-文件" aria-label="Permalink to &quot;4. 如何配置 Launch 与 Lua 文件&quot;">​</a></h2><h3 id="了解-bag-文件" tabindex="-1">了解 bag 文件 <a class="header-anchor" href="#了解-bag-文件" aria-label="Permalink to &quot;了解 bag 文件&quot;">​</a></h3><p>播放 bag 文件需要在 bag 的文件夹内启动五个终端 第一个终端执行 roscore 第二个终端执行 rosbag info rslidar-outdoor-gps.bag 了解 bag 中 topic 的名称与类型 第三个执行 rosbag play rslidar-outdoor-gps.bag 第四个终端执行 rqt 了解 bag 中的 tf 树.</p><h3 id="配置-launch-文件" tabindex="-1">配置 launch 文件 <a class="header-anchor" href="#配置-launch-文件" aria-label="Permalink to &quot;配置 launch 文件&quot;">​</a></h3><div class="language-vue vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">vue</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">launch</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  &lt;!-- bag的地址与名称 --&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  &lt;arg name=&quot;bag_filename&quot; default=&quot;$(env HOME)/bagfiles/rslidar-outdoor-gps-notf.bag&quot;/&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  &lt;!-- 使用bag的时间戳 --&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  &lt;param name=&quot;/use_sim_time&quot; value=&quot;true&quot; /&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  &lt;!-- 启动cartographer --&gt; </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  &lt;node name=&quot;cartographer_node&quot; pkg=&quot;cartographer_ros&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      type=&quot;cartographer_node&quot; args=&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">          -configuration_directory $(find cartographer_ros)/configuration_files</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">          -configuration_basename lx_rs16_2d_outdoor.lua&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      output=&quot;screen&quot;&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    &lt;!-- 点云 --&gt; </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    &lt;remap from=&quot;points2&quot; to=&quot;rslidar_points&quot; /&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    &lt;!-- 单线雷达 --&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    &lt;remap from=&quot;scan&quot; to=&quot;front_scan&quot; /&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    &lt;remap from=&quot;odom&quot; to=&quot;odom_scout&quot; /&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    &lt;remap from=&quot;imu&quot; to=&quot;imu&quot; /&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  &lt;/node&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  &lt;!-- 生成ros格式的地图 --&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  &lt;node name=&quot;cartographer_occupancy_grid_node&quot; pkg=&quot;cartographer_ros&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      type=&quot;cartographer_occupancy_grid_node&quot; args=&quot;-resolution 0.05&quot; /&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  &lt;!-- 启动rviz --&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  &lt;node name=&quot;rviz&quot; pkg=&quot;rviz&quot; type=&quot;rviz&quot; required=&quot;true&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      args=&quot;-d $(find cartographer_ros)/configuration_files/lx_2d.rviz&quot; /&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  &lt;!-- 启动rosbag --&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  &lt;node name=&quot;playbag&quot; pkg=&quot;rosbag&quot; type=&quot;play&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      args=&quot;--clock $(arg bag_filename)&quot; /&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">launch</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;</span></span></code></pre></div><h3 id="配置-lua-文件" tabindex="-1">配置 lua 文件 <a class="header-anchor" href="#配置-lua-文件" aria-label="Permalink to &quot;配置 lua 文件&quot;">​</a></h3><p>• tracking_frame 有 imu 的 link 就设置成 imu 的 link, 没有就设置成 base_link • published_frame cartographer 发布的 tf 的最下边一个坐标系, 就是 bag 文件中 tf树的最上边的一个坐标系 • provide_odom_frame 是否提供里程计, 如果 bag 中有里程计的坐标系, 这个就是false, 如果没有, 就根据需要决定是否提供里程计的坐标系 • use_pose_extrapolator = false 这个一定要设置成 false • use_odometry 是否使用里程计的传感器数据, 如果为 true, tf 树中一定要存在odom 这个坐标系 • use_nav_sat/use_landmarks 是否订阅里程计话题的数据, 以及 landmark 话题的数据 • num_laser_scans/num_point_clouds 单线点云与多线点云的话题的数量, 可以同时为 1, 不可以同时为 0 • num_subdivisions_per_laser_scan 一帧点云数据会被分成几次处理, 设置成 1 就行了 • MAP_BUILDER.use_trajectory_builder_2d = true 建二维图时一定要有这句话, 建三维图就把 2d 改成 3d<br> • TRAJECTORY_BUILDER_2D.use_imu_data 是否使用 imu, 如果用 imu,tracking_frame 一定要设置成 imu 的 link • TRAJECTORY_BUILDER_2D.min_z 点云的最小 z 的范围, 单线点云不能设置大于 0 的值(不设置), 多线点云的这个值要大于 0</p><div class="language-lua vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">lua</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">include</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;map_builder.lua&quot;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">include</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;trajectory_builder.lua&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">options </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  map_builder </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> MAP_BUILDER,                </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">-- map_builder.lua的配置信息</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  trajectory_builder </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> TRAJECTORY_BUILDER,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">-- trajectory_builder.lua的配置信息</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  map_frame </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;map&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,                        </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">-- 地图坐标系的名字</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">  --tracking_frame 有 imu 的 link 就设置成 imu 的 link, 没有就设置成 base_link</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  tracking_frame </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;imu_link&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,              </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">-- 将所有传感器数据转换到这个坐标系下</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">  -- 发布的 tf 的最下边一个坐标系, 就是 bag 文件中 tf树的最上边的一个坐标系</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  published_frame </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;footprint&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,            </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">-- tf: map -&gt; footprint</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  odom_frame </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;odom&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,                      </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">-- 里程计的坐标系名字</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  provide_odom_frame </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,               </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">-- 是否提供odom的tf, 如果为true,则tf树为map-&gt;odom-&gt;footprint</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">                                            -- 如果为false tf树为map-&gt;footprint</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  publish_frame_projected_to_2d </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,    </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">-- 是否将坐标系投影到平面上</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">  --use_pose_extrapolator = false,            -- 发布tf时是使用pose_extrapolator的位姿还是前端计算出来的位姿</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  use_odometry </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,                     </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">-- 是否使用里程计,如果使用要求一定要有odom的tf</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  use_nav_sat </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,                      </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">-- 是否使用gps</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  use_landmarks </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,                    </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">-- 是否使用landmark</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  num_laser_scans </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,                      </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">-- 是否使用单线激光数据</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  num_multi_echo_laser_scans </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,           </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">-- 是否使用multi_echo_laser_scans数据</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  num_subdivisions_per_laser_scan </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,      </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">-- 1帧数据被分成几次处理,一般为1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  num_point_clouds </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,                     </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">-- 是否使用点云数据</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  lookup_transform_timeout_sec </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0.2</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,       </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">-- 查找tf时的超时时间</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  submap_publish_period_sec </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0.3</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,          </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">-- 发布数据的时间间隔</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  pose_publish_period_sec </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 5e-3</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  trajectory_publish_period_sec </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 30e-3</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  rangefinder_sampling_ratio </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1.</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,          </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">-- 传感器数据的采样频率</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  odometry_sampling_ratio </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1.</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  fixed_frame_pose_sampling_ratio </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1.</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  imu_sampling_ratio </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1.</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  landmarks_sampling_ratio </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1.</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">MAP_BUILDER.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;">use_trajectory_builder_2d</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">   </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">TRAJECTORY_BUILDER_2D.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;">use_imu_data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> true</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">   -- 设置IMU数据</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">TRAJECTORY_BUILDER_2D.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;">min_range</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0.3</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">   --雷达的最大最小距离，根据雷达硬件设定</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">TRAJECTORY_BUILDER_2D.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;">max_range</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 100.</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">  --雷达的最大最小距离，根据雷达硬件设定</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">TRAJECTORY_BUILDER_2D.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;">min_z</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0.2</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">  --使用多点高以上的点云，单线的时候不要设置，多线防止打到地面上的点干扰建图</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">--TRAJECTORY_BUILDER_2D.max_z = 1.4</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">--TRAJECTORY_BUILDER_2D.voxel_filter_size = 0.02</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">--TRAJECTORY_BUILDER_2D.adaptive_voxel_filter.max_length = 0.5</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">--TRAJECTORY_BUILDER_2D.adaptive_voxel_filter.min_num_points = 200.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">--TRAJECTORY_BUILDER_2D.adaptive_voxel_filter.max_range = 50.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">--TRAJECTORY_BUILDER_2D.loop_closure_adaptive_voxel_filter.max_length = 0.9</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">--TRAJECTORY_BUILDER_2D.loop_closure_adaptive_voxel_filter.min_num_points = 100</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">--TRAJECTORY_BUILDER_2D.loop_closure_adaptive_voxel_filter.max_range = 50.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">TRAJECTORY_BUILDER_2D.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;">use_online_correlative_scan_matching</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> false</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">--ceres地图的扫描，平移，旋转的权重，影响建图效果，其他基本上是影响计算量等</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">--扫描匹配点云和地图匹配程度，值越大，点云和地图匹配置信度越高</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">TRAJECTORY_BUILDER_2D.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;">ceres_scan_matcher</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;">occupied_space_weight</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">--残差平移、旋转分量，值越大，越不相信和地图匹配的效果，而是越相信先验位姿的结果</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">TRAJECTORY_BUILDER_2D.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;">ceres_scan_matcher</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;">translation_weight</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">--如果imu不好，接入后地图旋转厉害，可以将这里的旋转权重减小</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">TRAJECTORY_BUILDER_2D.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;">ceres_scan_matcher</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;">rotation_weight</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">--TRAJECTORY_BUILDER_2D.ceres_scan_matcher.ceres_solver_options.max_num_iterations = 12</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">--TRAJECTORY_BUILDER_2D.motion_filter.max_distance_meters = 0.1</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">--TRAJECTORY_BUILDER_2D.motion_filter.max_angle_radians = 0.004</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">--TRAJECTORY_BUILDER_2D.imu_gravity_time_constant = 1.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">TRAJECTORY_BUILDER_2D.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;">submaps</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;">num_range_data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 80.</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">  --一个子图插入多少个节点，根据laser和运动速度进行具体的调整</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">TRAJECTORY_BUILDER_2D.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;">submaps</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;">grid_options_2d</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;">resolution</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0.1</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">POSE_GRAPH.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;">optimize_every_n_nodes</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 160.</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">   -- 2倍的num_range_data以上</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">POSE_GRAPH.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;">constraint_builder</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;">sampling_ratio</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0.3</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">   -- 如果添加的约束与潜在约束的比例低于此比例,则将添加约束</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">POSE_GRAPH.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;">constraint_builder</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;">max_constraint_distance</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 15.</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> -- 在子图附近考虑姿势的阈值,大于这个值将被略过</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">-- 回环检测阈值，如果不稳定有错误匹配，可以提高这两个值，场景重复可以降低或者关闭回环</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">POSE_GRAPH.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;">constraint_builder</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;">min_score</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0.48</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">POSE_GRAPH.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;">constraint_builder</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;">global_localization_min_score</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0.60</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> options</span></span></code></pre></div><p>既有单线又有多线的时候，考虑TRAJECTORY_BUILDER_2D.min_z = ，过滤掉地面的同时，也会过滤掉单线的数据，默认是-0.8，多线点云会打到地面，2d地图会变得不能用</p><h2 id="_5-参数的详解与调参总结" tabindex="-1">5. 参数的详解与调参总结 <a class="header-anchor" href="#_5-参数的详解与调参总结" aria-label="Permalink to &quot;5. 参数的详解与调参总结&quot;">​</a></h2><h3 id="trajectory-builder-lua" tabindex="-1">trajectory_builder.lua <a class="header-anchor" href="#trajectory-builder-lua" aria-label="Permalink to &quot;trajectory_builder.lua&quot;">​</a></h3><div class="language-lua vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">lua</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">include</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;trajectory_builder_2d.lua&quot;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">include</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;trajectory_builder_3d.lua&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">TRAJECTORY_BUILDER </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  trajectory_builder_2d </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> TRAJECTORY_BUILDER_2D,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  trajectory_builder_3d </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> TRAJECTORY_BUILDER_3D,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">--  pure_localization_trimmer = {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">--    max_submaps_to_keep = 3,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">--  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  collate_fixed_frame </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">-- 是否将数据放入阻塞队列中</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  collate_landmarks </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">-- 是否将数据放入阻塞队列中</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><h3 id="trajectory-builder-2d-lua" tabindex="-1">trajectory_builder_2d.lua <a class="header-anchor" href="#trajectory-builder-2d-lua" aria-label="Permalink to &quot;trajectory_builder_2d.lua&quot;">​</a></h3><div class="language-lua vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">lua</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">TRAJECTORY_BUILDER_2D.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;">use_imu_data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> true</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">   -- 对应自己配置的Lua文件</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">TRAJECTORY_BUILDER_2D.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;">min_range</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0.3</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">TRAJECTORY_BUILDER_2D.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;">max_range</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 100.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">TRAJECTORY_BUILDER_2D.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;">min_z</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0.2</span></span></code></pre></div><div class="language-lua vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">lua</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">TRAJECTORY_BUILDER_2D </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  use_imu_data </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,            </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">-- 是否使用imu数据</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  min_range </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0.</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,                 </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">-- 雷达数据的最远最近滤波, 保存中间值</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  max_range </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 30.</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  min_z </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">0.8</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,                   </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">-- 雷达数据的最高与最低的过滤, 保存中间值</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  max_z </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2.</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  missing_data_ray_length </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 5.</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,   </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">-- 超过最大距离范围的数据点用这个距离代替</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  num_accumulated_range_data </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">-- 几帧有效的点云数据进行一次扫描匹配 来一帧做一次 一般就是1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  voxel_filter_size </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0.025</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,      </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">-- 体素滤波的立方体的边长</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">  -- 使用固定的voxel滤波之后, 再使用自适应体素滤波器</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">  -- 体素滤波器 用于生成稀疏点云 以进行 扫描匹配</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  adaptive_voxel_filter </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    max_length </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0.5</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,             </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">-- 尝试确定最佳的立方体边长, 边长最大为0.5</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    min_num_points </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 200</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,         </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">-- 如果存在 较多点 并且大于&#39;min_num_points&#39;, 则减小体素长度以尝试获得该最小点数</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    max_range </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 50.</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,              </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">-- 距远离原点超过max_range 的点被移除</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  },</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">  -- 闭环检测的自适应体素滤波器, 用于生成稀疏点云 以进行 闭环检测</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  loop_closure_adaptive_voxel_filter </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    max_length </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0.9</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    min_num_points </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 100</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    max_range </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 50.</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  },</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">  -- 是否使用 real_time_correlative_scan_matcher 为ceres提供先验信息</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">  -- 计算复杂度高 , 但是很鲁棒 , 在odom或者imu不准时依然能达到很好的效果</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">  -- 只使用单线激光雷达，建图效果不好，设置位true，代价是计算量提高</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  use_online_correlative_scan_matching </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  real_time_correlative_scan_matcher </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    linear_search_window </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0.1</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,             </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">-- 线性搜索窗口的大小</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    angular_search_window </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> math.rad</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">20.</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">),  </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">-- 角度搜索窗口的大小</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    translation_delta_cost_weight </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1e-1</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,   </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">-- 用于计算各部分score的权重</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    rotation_delta_cost_weight </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1e-1</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">  -- ceres匹配的一些配置参数</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  ceres_scan_matcher </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    occupied_space_weight </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1.</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,   </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">-- 点云和地图匹配的权重</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    translation_weight </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 10.</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,     </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">-- 先验位姿和匹配之后位姿的平移偏移量</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    rotation_weight </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 40.</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    ceres_solver_options </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      use_nonmonotonic_steps </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      max_num_iterations </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 20</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      num_threads </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  },</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">  -- 为了防止子图里插入太多数据, 在插入子图之前之前对数据进行过滤</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  motion_filter </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    max_time_seconds </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 5.</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    max_distance_meters </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0.2</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    max_angle_radians </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> math.rad</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">1.</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  },</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">  -- TODO(schwoere,wohe): Remove this constant. This is only kept for ROS.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  imu_gravity_time_constant </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 10.</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">  -- 位姿预测器</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  pose_extrapolator </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    use_imu_based </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    constant_velocity </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      imu_gravity_time_constant </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 10.</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      pose_queue_duration </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0.001</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    imu_based </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      pose_queue_duration </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 5.</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      gravity_constant </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 9.806</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      pose_translation_weight </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1.</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      pose_rotation_weight </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1.</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      imu_acceleration_weight </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1.</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      imu_rotation_weight </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1.</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      odometry_translation_weight </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1.</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      odometry_rotation_weight </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1.</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      solver_options </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        use_nonmonotonic_steps </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        max_num_iterations </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 10</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        num_threads </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  },</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">  -- 子图相关的一些配置</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  submaps </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    num_range_data </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 90</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,          </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">-- 一个子图里插入雷达数据的个数的一半</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    grid_options_2d </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      grid_type </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;PROBABILITY_GRID&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">-- 地图的种类, 还可以是tsdf格式</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      resolution </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0.05</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,   </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">-- 地图的分辨率 很重要可以改</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    range_data_inserter </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      range_data_inserter_type </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;PROBABILITY_GRID_INSERTER_2D&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">      -- 概率占用栅格地图的一些配置</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      probability_grid_range_data_inserter </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        insert_free_space </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        hit_probability </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0.55</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        miss_probability </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0.49</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      },</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">      -- tsdf地图的一些配置</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      tsdf_range_data_inserter </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        truncation_distance </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0.3</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        maximum_weight </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 10.</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        update_free_space </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        normal_estimation_options </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">          num_normal_samples </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 4</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">          sample_radius </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0.5</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        project_sdf_distance_to_scan_normal </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        update_weight_range_exponent </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        update_weight_angle_scan_normal_to_ray_kernel_bandwidth </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0.5</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        update_weight_distance_cell_to_hit_kernel_bandwidth </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0.5</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><h3 id="trajectory-builder-3d-lua" tabindex="-1">trajectory_builder_3d.lua <a class="header-anchor" href="#trajectory-builder-3d-lua" aria-label="Permalink to &quot;trajectory_builder_3d.lua&quot;">​</a></h3><div class="language-lua vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">lua</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">MAX_3D_RANGE </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 60.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">INTENSITY_THRESHOLD </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 40</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">TRAJECTORY_BUILDER_3D </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  min_range </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1.</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  max_range </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> MAX_3D_RANGE,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  num_accumulated_range_data </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  voxel_filter_size </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0.15</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">  -- 在3d slam 时会有2个自适应体素滤波, 一个生成高分辨率点云, 一个生成低分辨率点云</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  high_resolution_adaptive_voxel_filter </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    max_length </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2.</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    min_num_points </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 150</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    max_range </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 15.</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  },</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  low_resolution_adaptive_voxel_filter </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    max_length </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 4.</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    min_num_points </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 200</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    max_range </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> MAX_3D_RANGE,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  },</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  use_online_correlative_scan_matching </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  real_time_correlative_scan_matcher </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    linear_search_window </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0.15</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    angular_search_window </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> math.rad</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">1.</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    translation_delta_cost_weight </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1e-1</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    rotation_delta_cost_weight </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1e-1</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  },</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  ceres_scan_matcher </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">    -- 在3D中,occupied_space_weight_0和occupied_space_weight_1参数分别与高分辨率和低分辨率滤波点云相关</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    occupied_space_weight_0 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1.</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    occupied_space_weight_1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 6.</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    intensity_cost_function_options_0 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        weight </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0.5</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        huber_scale </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0.3</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        intensity_threshold </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> INTENSITY_THRESHOLD,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    translation_weight </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 5.</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    rotation_weight </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 4e2</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    only_optimize_yaw </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    ceres_solver_options </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      use_nonmonotonic_steps </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      max_num_iterations </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 12</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      num_threads </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  },</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  motion_filter </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    max_time_seconds </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0.5</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    max_distance_meters </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0.1</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    max_angle_radians </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0.004</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  },</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  rotational_histogram_size </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 120</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">  -- TODO(schwoere,wohe): Remove this constant. This is only kept for ROS.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  imu_gravity_time_constant </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 10.</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  pose_extrapolator </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    use_imu_based </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    constant_velocity </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      imu_gravity_time_constant </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 10.</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      pose_queue_duration </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0.001</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    },</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">    -- TODO(wohe): Tune these parameters on the example datasets.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    imu_based </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      pose_queue_duration </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 5.</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      gravity_constant </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 9.806</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      pose_translation_weight </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1.</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      pose_rotation_weight </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1.</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      imu_acceleration_weight </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1.</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      imu_rotation_weight </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1.</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      odometry_translation_weight </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1.</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      odometry_rotation_weight </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1.</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      solver_options </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        use_nonmonotonic_steps </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        max_num_iterations </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 10</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        num_threads </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  },</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  submaps </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">    -- 2种分辨率的地图</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    high_resolution </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0.10</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,           </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">-- 用于近距离测量的高分辨率hybrid网格 for local SLAM and loop closure, 用来与小尺寸voxel进行精匹配</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    high_resolution_max_range </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 20.</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">-- 在插入 high_resolution map 之前过滤点云的最大范围</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    low_resolution </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0.45</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    num_range_data </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 160</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,             </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">-- 用于远距离测量的低分辨率hybrid网格 for local SLAM only, 用来与大尺寸voxel进行粗匹配</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    range_data_inserter </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      hit_probability </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0.55</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      miss_probability </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0.49</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      num_free_space_voxels </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      intensity_threshold </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> INTENSITY_THRESHOLD,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  },</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">  -- When setting use_intensites to true, the intensity_cost_function_options_0</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">  -- parameter in ceres_scan_matcher has to be set up as well or otherwise</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">  -- CeresScanMatcher will CHECK-fail.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  use_intensities </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><h3 id="map-builder-lua" tabindex="-1">map_builder.lua <a class="header-anchor" href="#map-builder-lua" aria-label="Permalink to &quot;map_builder.lua&quot;">​</a></h3><div class="language-lua vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">lua</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">include</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;pose_graph.lua&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">MAP_BUILDER </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  use_trajectory_builder_2d </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,    </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">-- 这两个一定有一个是true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  use_trajectory_builder_3d </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,    </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">-- 这两个一定有一个是true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  num_background_threads </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 4</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  pose_graph </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> POSE_GRAPH,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  collate_by_trajectory </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><h3 id="pose-graph-lua" tabindex="-1">pose_graph.lua <a class="header-anchor" href="#pose-graph-lua" aria-label="Permalink to &quot;pose_graph.lua&quot;">​</a></h3><div class="language-lua vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">lua</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">POSE_GRAPH </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">  -- 每隔多少个节点执行一次后端优化  子图插入到160个节点，</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  optimize_every_n_nodes </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 90</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,    </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">-- 可以设置为TRAJECTORY_BUILDER_2D.submaps.num_range_data的两倍</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">  -- 约束构建的相关参数</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  constraint_builder </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    sampling_ratio </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0.3</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,                 </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">-- 对局部子图进行回环检测时的计算频率, 数值越大, 计算次数越多</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    max_constraint_distance </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 15.</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,        </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">-- 对局部子图进行回环检测时能成为约束的最大距离</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    min_score </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0.55</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,                     </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">-- 对局部子图进行回环检测时的最低分数阈值</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    global_localization_min_score </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0.6</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">-- 对整体子图进行回环检测时的最低分数阈值</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    loop_closure_translation_weight </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1.1e4</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    loop_closure_rotation_weight </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1e5</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    log_matches </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,                   </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">-- 打印约束计算的log</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">    -- 基于分支定界算法的2d粗匹配器</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    fast_correlative_scan_matcher </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      linear_search_window </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 7.</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      angular_search_window </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> math.rad</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">30.</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      branch_and_bound_depth </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 7</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    },</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">    -- 基于ceres的2d精匹配器</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    ceres_scan_matcher </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      occupied_space_weight </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 20.</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      translation_weight </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 10.</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      rotation_weight </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1.</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      ceres_solver_options </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        use_nonmonotonic_steps </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        max_num_iterations </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 10</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        num_threads </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    },</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">    -- 基于分支定界算法的3d粗匹配器</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    fast_correlative_scan_matcher_3d </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      branch_and_bound_depth </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 8</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      full_resolution_depth </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 3</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      min_rotational_score </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0.77</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      min_low_resolution_score </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0.55</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      linear_xy_search_window </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 5.</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      linear_z_search_window </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1.</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      angular_search_window </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> math.rad</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">15.</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    },</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">    -- 基于ceres的3d精匹配器</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    ceres_scan_matcher_3d </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      occupied_space_weight_0 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 5.</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      occupied_space_weight_1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 30.</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      translation_weight </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 10.</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      rotation_weight </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1.</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      only_optimize_yaw </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      ceres_solver_options </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        use_nonmonotonic_steps </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        max_num_iterations </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 10</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        num_threads </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  },</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  matcher_translation_weight </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 5e2</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  matcher_rotation_weight </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1.6e3</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">  -- 优化残差方程的相关参数</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  optimization_problem </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    huber_scale </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1e1</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,                </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">-- 值越大,（潜在）异常值的影响就越大</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    acceleration_weight </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1.1e2</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,      </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">-- 3d里imu的线加速度的权重</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    rotation_weight </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1.6e4</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,          </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">-- 3d里imu的旋转的权重</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">     </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">    -- 前端结果残差的权重</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    local_slam_pose_translation_weight </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1e5</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    local_slam_pose_rotation_weight </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1e5</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">    -- 里程计残差的权重</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    odometry_translation_weight </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1e5</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    odometry_rotation_weight </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1e5</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">    -- gps残差的权重</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    fixed_frame_pose_translation_weight </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1e1</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    fixed_frame_pose_rotation_weight </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1e2</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    fixed_frame_pose_use_tolerant_loss </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    fixed_frame_pose_tolerant_loss_param_a </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    fixed_frame_pose_tolerant_loss_param_b </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    log_solver_summary </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    use_online_imu_extrinsics_in_3d </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    fix_z_in_3d </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    ceres_solver_options </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      use_nonmonotonic_steps </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      max_num_iterations </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 50</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      num_threads </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 7</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  },</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  max_num_final_iterations </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 200</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,   </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">-- 在建图结束之后执行一次全局优化, 不要求实时性, 迭代次数多</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  global_sampling_ratio </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0.003</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,    </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">-- 纯定位时候查找回环的频率</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  log_residual_histograms </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  global_constraint_search_after_n_seconds </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 10.</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">-- 纯定位时多少秒执行一次全子图的约束计算</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">  --  overlapping_submaps_trimmer_2d = {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">  --    fresh_submaps_count = 1,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">  --    min_covered_area = 2,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">  --    min_added_submaps_count = 5,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">  --  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><h3 id="常调的参数" tabindex="-1">常调的参数 <a class="header-anchor" href="#常调的参数" aria-label="Permalink to &quot;常调的参数&quot;">​</a></h3><div class="language-lua vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">lua</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">TRAJECTORY_BUILDER_2D.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;">min_range</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0.3</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">TRAJECTORY_BUILDER_2D.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;">max_range</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 100.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">TRAJECTORY_BUILDER_2D.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;">min_z</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0.2</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> -- / -0.8</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">TRAJECTORY_BUILDER_2D.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;">voxel_filter_size</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0.02</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">-- 调参建图效果 </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">TRAJECTORY_BUILDER_2D.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;">ceres_scan_matcher</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;">occupied_space_weight</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">10.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">-- 平移和旋转</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">TRAJECTORY_BUILDER_2D.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;">ceres_scan_matcher</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;">translation_weight</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">TRAJECTORY_BUILDER_2D.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;">ceres_scan_matcher</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;">rotation_weight</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">TRAJECTORY_BUILDER_2D.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;">submaps</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;">num_range_data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 80.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">TRAJECTORY_BUILDER_2D.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;">submaps</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;">grid_options_2d</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;">resolution</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0.1</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> -- /0.02</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">POSE_GRAPH.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;">optimize_every_n_nodes</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 160.</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> -- 2 倍的 num_range_data 以上</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">POSE_GRAPH.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;">constraint_builder</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;">sampling_ratio</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0.3</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">POSE_GRAPH.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;">constraint_builder</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;">max_constraint_distance</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 15.</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> -- 回环检测最大距离</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">POSE_GRAPH.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;">constraint_builder</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;">min_score</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0.48</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">  -- 回环检测阈值</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">POSE_GRAPH.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;">constraint_builder</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;">global_localization_min_score</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0.60</span></span></code></pre></div><h3 id="降低延迟与减小计算量" tabindex="-1">降低延迟与减小计算量 <a class="header-anchor" href="#降低延迟与减小计算量" aria-label="Permalink to &quot;降低延迟与减小计算量&quot;">​</a></h3><h4 id="前端部分" tabindex="-1">前端部分 <a class="header-anchor" href="#前端部分" aria-label="Permalink to &quot;前端部分&quot;">​</a></h4><p>• 减小 max_range, 减小了需要处理的点数, 在雷达数据远距离的点不准时一定要减小这个值 • 增大 voxel_filter_size, 相当于减小了需要处理的点数 • 增大 submaps.resolution, 相当于减小了匹配时的搜索量 • 对于自适应体素滤波 减小 min_num_points 与 max_range, 增大 max_length, 相当于减小了需要处理的点数</p><h4 id="后端部分" tabindex="-1">后端部分 <a class="header-anchor" href="#后端部分" aria-label="Permalink to &quot;后端部分&quot;">​</a></h4><p>• 增大 optimize_every_n_nodes, 降低优化频率, 减小了计算量 • 增大 MAP_BUILDER.num_background_threads, 增加计算速度 • 减小 global_sampling_ratio, 减小计算全局约束的频率 • 减小 constraint_builder.sampling_ratio, 减少了约束的数量 • 增大 constraint_builder.min_score, 减少了约束的数量<br> • 减小分枝定界搜索窗的大小, 包括linear_xy_search_window,inear_z_search_window,angular_search_window • 增大 global_constraint_search_after_n_seconds, 减小计算全局约束的频率 • 减小 max_num_iterations, 减小迭代次数</p><h4 id="降低内存" tabindex="-1">降低内存 <a class="header-anchor" href="#降低内存" aria-label="Permalink to &quot;降低内存&quot;">​</a></h4><p>增大子图的分辨率 submaps.resolution</p><h4 id="降低纯定位时错误重定位的概率" tabindex="-1">降低纯定位时错误重定位的概率 <a class="header-anchor" href="#降低纯定位时错误重定位的概率" aria-label="Permalink to &quot;降低纯定位时错误重定位的概率&quot;">​</a></h4><p>修改 pose_graph.lua 中的如下参数 • 提高 optimize_every_n_nodes , 减小了优化的次数 • 减小 sampling_ratio, 减小了计算约束的次数 • 减小 max_constraint_distance, 减小了计算约束的距离 • 提高 min_score, 减小了计算约束的数量, 提高约束正确的概率 • 提高 global_localization_min_score, 减小了计算约束的数量, 提高约束正确的概率 • 提高 global_constraint_search_after_n_seconds , 减小了回环的次数(隔多长时间计算一次)</p><h2 id="_6-论文解读" tabindex="-1">6. 论文解读 <a class="header-anchor" href="#_6-论文解读" aria-label="Permalink to &quot;6. 论文解读&quot;">​</a></h2>`,96))])}const v=e(D,[["render",F]]);export{q as __pageData,v as default};
